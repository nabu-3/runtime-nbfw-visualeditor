try{if(!Nabu){throw"Nabu Manager not loaded"}}catch(e){throw"Nabu Manager not loaded"}if(typeof Nabu.VisualEditor==="undefined"){Nabu.VisualEditor=function(){}}Nabu.VisualEditor.Grid=function(a){var f=this;this.graph=a;try{this.canvas=document.createElement("canvas");this.canvas.style.position="absolute";this.canvas.style.top="0px";this.canvas.style.left="0px";this.canvas.style.zIndex=-1;a.container.appendChild(this.canvas);this.ctx=this.canvas.getContext("2d");var c=mxGraphView.prototype.isContainerEvent;mxGraphView.prototype.isContainerEvent=function(g){return c.apply(this,arguments)||mxEvent.getSource(g)==f.canvas};this.s=0;this.gs=0;this.tr=new mxPoint();this.w=0;this.h=0}catch(b){mxLog.show();mxLog.debug("Using background image");a.container.style.backgroundImage="url('editors/images/grid.gif')"}var d=mxGraphView.prototype.validateBackground;mxGraphView.prototype.validateBackground=function(){d.apply(this,arguments);f.repaintGrid()}};Nabu.VisualEditor.Grid.prototype={repaintGrid:function(){if(this.ctx!==null){var i=this.graph.getGraphBounds();var q=Math.max(i.x+i.width,this.graph.container.clientWidth);var p=Math.max(i.y+i.height,this.graph.container.clientHeight);var n=q!=this.w||p!=this.h;if(this.graph.view.scale!=this.s||this.graph.view.translate.x!=this.tr.x||this.graph.view.translate.y!=this.tr.y||this.gs!=this.graph.gridSize||n){this.tr=this.graph.view.translate.clone();this.s=this.graph.view.scale;this.gs=this.graph.gridSize;this.w=q;this.h=p;if(!n){this.ctx.clearRect(0,0,this.w,this.h)}else{this.canvas.setAttribute("width",this.w);this.canvas.setAttribute("height",this.h)}var z=this.tr.x*this.s;var w=this.tr.y*this.s;var g=this.graph.gridSize;var l=g*this.s;if(l<g){var h=Math.round(Math.ceil(g/l)/2)*2;l=h*l}var j=Math.floor((0-z)/l)*l+z;var r=Math.ceil(this.w/l)*l;var s=Math.floor((0-w)/l)*l+w;var a=Math.ceil(this.h/l)*l;r+=Math.ceil(l);a+=Math.ceil(l);var o=Math.round(j);var t=Math.round(r);var u=Math.round(s);var b=Math.round(a);for(var m=j,v=0;m<=r;m+=l,v=(v+1)%10){m=Math.round((m-z)/l)*l+z;var f=Math.round(m);if(v===0){this.ctx.strokeStyle="#93a1a140"}else{this.ctx.strokeStyle="#eee8d5"}this.ctx.beginPath();this.ctx.moveTo(f+0.5,u+0.5);this.ctx.lineTo(f+0.5,b+0.5);this.ctx.closePath();this.ctx.stroke()}for(var k=s,v=0;k<=a;k+=l,v=(v+1)%10){k=Math.round((k-w)/l)*l+w;var d=Math.round(k);if(v===0){this.ctx.strokeStyle="#93a1a140"}else{this.ctx.strokeStyle="#eee8d5"}this.ctx.beginPath();this.ctx.moveTo(o+0.5,d+0.5);this.ctx.lineTo(t+0.5,d+0.5);this.ctx.closePath();this.ctx.stroke()}}}}};nabu.registerLibrary("VE.Grid");