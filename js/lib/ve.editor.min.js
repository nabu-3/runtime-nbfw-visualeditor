try{if(!Nabu){throw"Nabu Manager not loaded"}}catch(e){throw"Nabu Manager not loaded"}if(typeof Nabu.VisualEditor==="undefined"){Nabu.VisualEditor=function(){}}Nabu.VisualEditor.Editor=function(a,b){this.container=a;this.config=b;this.editor=null;this.grid=null;this.events=new Nabu.EventPool();this.wheelLocked=0};Nabu.VisualEditor.Editor.prototype={init:function(){var f=this;var a=false;if(!mxClient.isBrowserSupported()){mxUtils.error("Browser is not supported!",200,false)}else{mxEvent.disableContextMenu(document.body);var c=mxUtils.load(this.config).getDocumentElement();this.editor=new mxEditor(c);this.editor.setGraphContainer(this.container);var d=this.editor.graph;var b=d.getModel();d.setPanning(true);d.panningHandler.useLeftButtonForPanning=false;d.setHtmlLabels(true);d.setConnectable(true);d.setDisconnectOnMove(false);d.popupMenuHandler.autoExpand=true;new mxRubberband(d);d.addListener(mxEvent.CELLS_ADDED,function(h,g){console.log("CELLS_ADDED");console.log(g)});d.addListener(mxEvent.CELLS_RESIZED,function(h,g){f.events.fireEvent("onCellsResized",h,g)});d.addListener(mxEvent.CELLS_MOVED,function(h,g){console.log("CELLS_MOVED");console.log(g);f.events.fireEvent("onCellsMoved",h,g)});d.addListener(mxEvent.CELLS_REMOVED,function(h,g){console.log("CELLS_REMOVED");console.log(g)});d.addListener(mxEvent.SPLIT_EDGE,function(h,g){console.log("SPLIT_EDGE");console.log(g)});d.addListener(mxEvent.FLIP_EDGE,function(h,g){console.log("FLIP_EDGE");console.log(g)});d.addListener(mxEvent.CONNECT,function(h,g){console.log("CONNECT");console.log(g)});d.addListener(mxEvent.DISCONNECT,function(h,g){console.log("DISCONNECT");console.log(g)});d.addListener(mxEvent.CELL_CONNECTED,function(h,g){f.events.fireEvent("onCellsConnected",h,g)});d.popupMenuHandler.factoryMethod=function(i,g,h){f.events.fireEvent("onPopupMenu",i,{evt:h,cell:g})};a=true}return a},addEventListener:function(a){this.events.addEventListener(a)},removeEventListener:function(a){this.events.removeEventListener(a)},lockWheel:function(){this.wheelLocked++},unlockWheel:function(){this.wheelLocked--},enableMouseWheel:function(){var a=this;mxEvent.addMouseWheelListener(function(c,b){if(a.wheelLocked===0){if(b){a.editor.graph.zoomIn()}else{a.editor.graph.zoomOut()}mxEvent.consume(c)}})},enableGrid:function(){this.editor.graph.graphHandler.scaleGrid=true;this.grid=new Nabu.VisualEditor.Grid(this.editor.graph)},enableGuides:function(){mxGraphHandler.prototype.guidesEnabled=true},enableVertexLivePreview:function(){mxVertexHandler.prototype.livePreview=true},enableEdgeLayout:function(){var c=this;var a=new mxParallelEdgeLayout(this.editor.graph);var b=new mxLayoutManager(this.editor.graph);this.editor.graph.addListener(mxEvent.CELL_CONNECTED,function(g,d){var f=c.editor.graph.getModel();var h=d.getProperty("edge");c.layoutEdge(a,h)});b.getLayout=function(d){return d.getChildCount()>0?a:null}},layoutEdge:function(d,c){var b=this.editor.graph.getModel();var f=b.getTerminal(c,true);var a=b.getTerminal(c,false);d.isEdgeIgnored=function(h){var i=b.getTerminal(h,true);var g=b.getTerminal(h,false);return !(b.isEdge(h)&&((f==i&&a==g)||(f==g&&a==i)))};d.execute(this.editor.graph.getDefaultParent())},load:function(b){var c=this;var a=new Nabu.Ajax.Connector(b,"GET");a.addEventListener(new Nabu.Event({onLoad:function(d){c.editor.readGraphModel(d.params.xml.documentElement)}}));a.execute()},setDefaultVertexFillColor:function(a){var b=this.editor.graph.getStylesheet().getDefaultVertexStyle();b[mxConstants.STYLE_FILLCOLOR]=a},setDefaultEdgeRounded:function(a){style=this.editor.graph.getStylesheet().getDefaultEdgeStyle();style[mxConstants.STYLE_ROUNDED]=a},setDefaultEdgeTypeAsElbowConnector:function(a){style=this.editor.graph.getStylesheet().getDefaultEdgeStyle();style[mxConstants.STYLE_EDGE]=mxEdgeStyle.ElbowConnector;this.editor.graph.alternateEdgeStyle="elbow="+a},fillWithSample:function(){var c=this.editor.graph;var a=c.getModel();var b=c.getDefaultParent();a.beginUpdate();try{var g=c.insertVertex(b,null,"Hello,",20,20,80,30);var f=c.insertVertex(b,null,"World!",200,150,80,30);var d=c.insertEdge(b,null,"",g,f)}finally{a.endUpdate()}}};nabu.registerLibrary("VE.Editor",["VE.Shapes","VE.Grid","Ajax","Event"]);